(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{559:function(t,e,i){"use strict";i.d(e,"b",function(){return a}),i.d(e,"a",function(){return n});var r=i(107);const a=t=>{const e=new FileReader;return new Promise((i,r)=>{try{e.readAsDataURL(t),e.onloadend=()=>{i(e.result)}}catch(t){throw new Error("Ошибка при чтении файла")}})},n=t=>{return`${r.a.defaults.baseURL}/${t}`}},560:function(t,e,i){},562:function(t,e,i){"use strict";var r=i(560);i.n(r).a},563:function(t,e,i){},572:function(t,e,i){"use strict";var r=function(){var t=this.$createElement;return(this._self._c||t)("button",{staticClass:"btn-styled",attrs:{type:this.type}},[this._v(this._s(this.title))])};r._withStripped=!0;var a={props:{title:String,type:String}},n=(i(562),i(3)),o=Object(n.a)(a,r,[],!1,null,"1bfc0524",null);o.options.__file="src/admin/components/app-button.vue";e.a=o.exports},574:function(t,e,i){"use strict";var r=i(563);i.n(r).a},584:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content-feedback__new"},[i("h5",{staticClass:"content__new-title"},[t._v(t._s(t.title))]),i("div",{staticClass:"content-feedback__new-content"},[i("label",{staticClass:"new-content__picture",class:{error:t.validation.hasError("review.photo")}},[i("input",{staticClass:"reviews__form-file-input",attrs:{type:"file"},on:{change:t.appendFileAndRenderPhoto}}),i("div",{staticClass:"new-content__picture-pic"},[i("div",{staticClass:"feedback__pic",class:{filled:this.rendedPhotoUrl.length},style:{backgroundImage:"url("+this.rendedPhotoUrl+")"}})]),i("div",{staticClass:"new-content__picture-text"},[t._v("Add photo")]),i("div",{staticClass:"edit-form__file-error"},[i("errors-tooltip",{attrs:{errorText:t.validation.firstError("review.photo")}})],1)]),i("form",{staticClass:"new-content__info",attrs:{action:""}},[i("div",{staticClass:"new-content__info-author"},[i("app-input",{staticClass:"info-author",attrs:{type:"text",title:"Author's name",placeholder:"Bruce Wayne",errorText:t.validation.firstError("review.author")},model:{value:t.review.author,callback:function(e){t.$set(t.review,"author",e)},expression:"review.author"}}),i("app-input",{staticClass:"info-author",attrs:{type:"text",title:"Author's title",placeholder:"Batman",errorText:t.validation.firstError("review.occ")},model:{value:t.review.occ,callback:function(e){t.$set(t.review,"occ",e)},expression:"review.occ"}})],1),i("div",{staticClass:"new-content__info-text"},[i("app-input",{staticClass:"info-text",attrs:{title:"Feedback","field-type":"textarea",errorText:t.validation.firstError("review.text")},model:{value:t.review.text,callback:function(e){t.$set(t.review,"text",e)},expression:"review.text"}})],1),i("div",{staticClass:"new-content__info-buttons"},[i("button",{staticClass:"button-cancel",attrs:{type:"reset"},on:{click:t.closeForm}},[t._v("Cancel")]),i("button",{staticClass:"save",attrs:{type:"submit"},on:{click:function(e){"add"===t.mode?t.addReview():t.editCurrentReview()}}},[t._v("Save")])])])])])};r._withStripped=!0;var a=i(10),n=i(559),o=i(16),s=i(66),c=i(572),l={mixins:[i(16).mixin],validators:{"review.author":t=>o.Validator.value(t).required("Enter name"),"review.occ":t=>o.Validator.value(t).required("Enter occupation"),"review.text":t=>o.Validator.value(t).required("Leave feedback"),"review.photo":t=>o.Validator.value(t).required("Need photo")},props:{title:{type:String,default:"New review"},mode:{type:String,default:"add",validator:t=>["add","edit"].includes(t)}},components:{appInput:s.default,appButton:c.a,errorsTooltip:()=>i.e(0).then(i.bind(null,588))},data:()=>({rendedPhotoUrl:"",review:{id:0,author:"",occ:"",text:"",photo:""}}),computed:{...Object(a.d)("feedback",{currentReview:t=>t.currentReview}),userAvatarUrl(){return`url(${this.rendedPhotoUrl})`}},watch:{currentReview(t){"edit"===this.mode&&this.fillFormWithCurrentReviewData()}},created(){"edit"===this.mode&&this.fillFormWithCurrentReviewData()},methods:{...Object(a.b)("feedback",["addNewReview","updateReview"]),appendFileAndRenderPhoto(t){const e=t.target.files[0];this.review.photo=e;const i=new FileReader;try{i.readAsDataURL(e),i.onload=()=>{this.rendedPhotoUrl=i.result}}catch(t){alert("Error during photo rendering")}},async addReview(){if(!1===await this.$validate())return;const t=new FormData;t.append("author",this.review.author),t.append("occ",this.review.occ),t.append("text",this.review.text),t.append("photo",this.review.photo);try{await this.addNewReview(t),this.clearFormFields()}catch(t){alert("Error during review adding")}finally{this.validation.reset()}},async editCurrentReview(){if(!1!==await this.$validate())try{await this.updateReview(this.review);this.$emit("cancel")}catch(t){alert("Error during review editing")}finally{this.validation.reset()}},closeForm(){this.review={},this.$emit("cancel")},clearFormFields(){this.review={},this.rendedPhotoUrl=""},fillFormWithCurrentReviewData(){this.review={...this.currentReview},this.rendedPhotoUrl=Object(n.a)(this.currentReview.photo)}}},d=(i(574),i(3)),u=Object(d.a)(l,r,[],!1,null,"1c9e5e2c",null);u.options.__file="src/admin/components/feedback-form.vue";e.default=u.exports}}]);