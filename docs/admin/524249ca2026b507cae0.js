(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{559:function(t,e,r){"use strict";r.d(e,"b",function(){return i}),r.d(e,"a",function(){return a});var o=r(107);const i=t=>{const e=new FileReader;return new Promise((r,o)=>{try{e.readAsDataURL(t),e.onloadend=()=>{r(e.result)}}catch(t){throw new Error("Ошибка при чтении файла")}})},a=t=>{return`${o.a.defaults.baseURL}/${t}`}},565:function(t,e,r){},576:function(t,e,r){"use strict";var o=r(565);r.n(o).a},586:function(t,e,r){"use strict";r.r(e);var o=function(){var t=this,e=this,r=e.$createElement,o=e._self._c||r;return o("div",{staticClass:"content-works__new"},[o("h5",{staticClass:"content__new-title"},[e._v(e._s(e.title))]),o("div",{staticClass:"works-new__content"},[o("div",{staticClass:"works-new__column"},[e.renderedPhoto.length?o("div",{staticClass:"edit-form__btn"},[o("div",{staticClass:"edit-form__pic",style:{backgroundImage:e.workPhotoUrl}}),o("label",{staticClass:"edit-form__change-preview"},[o("a",{staticClass:"edit-form__change-pic"},[e._v("Change preview")]),o("input",{staticClass:"edit-form__preview-input",attrs:{type:"file"},on:{change:e.handlePhotoUpload}})])]):o("label",{staticClass:"edit-form__picture",class:{error:e.validation.hasError("work.photo")}},[o("div",{staticClass:"edit-form__picture-text"},[e._v("Drag or download picture")]),o("app-button",{attrs:{elem:"file",text:"Download"},on:{change:e.handlePhotoUpload}}),o("div",{staticClass:"edit-form__file-error"},[o("errors-tooltip",{attrs:{errorText:e.validation.firstError("work.photo")}})],1)],1)]),o("div",{staticClass:"works-new__column works-new__column_mod"},[o("app-input",{staticClass:"work-name",attrs:{type:"text",title:"Name",placeholder:"Site's name",errorText:e.validation.firstError("work.title")},model:{value:e.work.title,callback:function(t){e.$set(e.work,"title",t)},expression:"work.title"}}),o("app-input",{staticClass:"work-name",attrs:{type:"text",title:"Link",placeholder:"google.com",errorText:e.validation.firstError("work.link")},model:{value:e.work.link,callback:function(t){e.$set(e.work,"link",t)},expression:"work.link"}}),o("app-input",{staticClass:"work-name",attrs:{"field-type":"textarea",title:"Description",errorText:e.validation.firstError("work.description")},model:{value:e.work.description,callback:function(t){e.$set(e.work,"description",t)},expression:"work.description"}}),o("add-tags",{staticClass:"work-name",attrs:{errorText:e.validation.firstError("work.techs")},on:{removeTag:function(e){return t.work.techs=e}},model:{value:e.work.techs,callback:function(t){e.$set(e.work,"techs",t)},expression:"work.techs"}}),o("div",{staticClass:"new-content__info-buttons new-content__info-buttons_mod"},[o("button",{staticClass:"button-cancel",attrs:{type:"reset"},on:{click:e.closeForm}},[e._v("Cancel")]),o("button",{staticClass:"save",attrs:{type:"submit"},on:{click:function(t){"add"===e.mode?e.addWork():e.editCurrentWork()}}},[e._v("Save")])])],1)])])};o._withStripped=!0;var i=r(10),a=r(559),s=r(16),n={mixins:[r(16).mixin],validators:{"work.title":t=>s.Validator.value(t).required("Enter work name"),"work.link":t=>s.Validator.value(t).required("Enter work site"),"work.description":t=>s.Validator.value(t).required("Describe work"),"work.techs":t=>s.Validator.value(t).required("Enter technologies"),"work.photo":t=>s.Validator.value(t).required("Add photo")},props:{title:{type:String,default:"New work"},mode:{type:String,default:"add",validator:t=>["add","edit"].includes(t)},disabled:{type:Boolean,default:!1}},components:{appInput:()=>Promise.resolve().then(r.bind(null,66)),addTags:()=>r.e(8).then(r.bind(null,590)),appButton:()=>r.e(9).then(r.bind(null,591)),errorsTooltip:()=>r.e(0).then(r.bind(null,588))},data(){return{disableForm:this.disabled,renderedPhoto:"",work:{id:0,title:"",techs:"",link:"",photo:"",description:""}}},computed:{...Object(i.d)("works",{currentWork:t=>t.currentWork}),workPhotoUrl(){return`url(${this.renderedPhoto})`}},created(){"edit"===this.mode&&this.fillFormWithCurrentWorkData()},watch:{currentWork(t){"edit"===this.mode&&this.fillFormWithCurrentWorkData()},mode(t){"add"===t&&this.clearFormFields()}},methods:{...Object(i.b)("works",["addNewWork","updateWork"]),async editCurrentWork(){if(!1!==await this.$validate()){this.disableForm=!0;try{await this.updateWork(this.work);this.$emit("cancel")}catch(t){alert("Error during work editing")}finally{this.disableForm=!1,this.validation.reset()}}},async addWork(){if(!1===await this.$validate())return;this.disableForm=!0;const t=new FormData;t.append("title",this.work.title),t.append("techs",this.work.techs),t.append("link",this.work.link),t.append("photo",this.work.photo),t.append("description",this.work.description);try{await this.addNewWork(t);this.clearFormFields()}catch(t){alert("Error during work adding")}finally{this.disableForm=!1,this.validation.reset()}},closeForm(){this.clearFormFields(),this.$emit("cancel")},clearFormFields(){this.work={},this.renderedPhoto=""},fillFormWithCurrentWorkData(){this.work={...this.currentWork},this.renderedPhoto=Object(a.a)(this.currentWork.photo)},async handlePhotoUpload(t){const e=t.target.files[0];this.work.photo=e;try{const t=await Object(a.b)(e);this.renderedPhoto=t}catch(t){alert("Error during photo rendering")}}}},l=(r(576),r(3)),d=Object(l.a)(n,o,[],!1,null,"5f3700bf",null);d.options.__file="src/admin/components/works-form.vue";e.default=d.exports}}]);